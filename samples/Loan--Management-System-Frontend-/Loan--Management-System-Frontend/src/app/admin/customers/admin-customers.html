<div class="section">

  <!-- ======================
       BACK BUTTON
  ======================= -->
  <button *ngIf="selectedCustomer"
          class="btn back"
          (click)="back()">
    ← Back to Customers
  </button>

  <!-- ======================
       CUSTOMER LIST
  ======================= -->
  <div class="customer-list"
       *ngIf="!selectedCustomer && !loading">

    <div class="customer-card"
         *ngFor="let c of customers"
         [ngClass]="[
  c.kycStatus?.toLowerCase(),
  c.accountStatus?.toLowerCase()
]"

         (click)="selectCustomer(c)">

      <div class="customer-main">
        <p class="name">{{ c.fullName }}</p>
        <p class="email">{{ c.email }}</p>
        <p class="id">ID: {{ c.customerId }}</p>
      </div>

      <div class="customer-meta">
        <div>
          <small>Mobile</small>
          <p>{{ c.mobile }}</p>
        </div>

        <div>
          <small>KYC</small>
          <span class="status">{{ c.kycStatus }}</span>
        </div>

        <div>
          <small>Account</small>
          <span class="status">{{ c.accountStatus }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ======================
       SELECTED CUSTOMER CARD
  ======================= -->
  <!-- SELECTED CUSTOMER -->
<div *ngIf="selectedCustomer"
     class="customer-card selected"
     (click)="loadPayments()">

  <div class="customer-main">
    <p class="name">{{ selectedCustomer.fullName }}</p>
    <p class="email">{{ selectedCustomer.email }}</p>
    <p class="id">ID: {{ selectedCustomer.customerId }}</p>
  </div>

  <div class="customer-meta">
    <div>
      <small>Status</small>
      <span class="status">{{ selectedCustomer.accountStatus }}</span>
    </div>

    <div class="actions">

      <button *ngIf="selectedCustomer.accountStatus !== 'ACTIVE'"
              class="btn activate"
              (click)="activateCustomer($event)">
        Activate
      </button>

      <button *ngIf="selectedCustomer.accountStatus === 'ACTIVE'"
              class="btn deactivate"
              (click)="suspendCustomer($event)">
        Suspend
      </button>

      <button class="btn delete"
              (click)="deleteCustomer($event)">
        Delete
      </button>

    </div>
  </div>
</div>


  <!-- ======================
       EMI HISTORY
  ======================= -->
  <h3 *ngIf="paymentsLoaded">EMI History</h3>

  <p *ngIf="loadingPayments">Loading EMIs...</p>

  <div class="emi-table"
       *ngIf="paymentsLoaded && payments.length">

    <div class="emi-header">
      <span>EMI #</span>
      <span>Date</span>
      <span>Amount</span>
      <span>Status</span>
      <span>Action</span>
    </div>

    <div class="emi-row"
         *ngFor="let p of payments">

      <span class="emi-no">{{ p.emiNumber }}</span>

      <span class="date">

  <!-- PAID EMI -->
  <ng-container *ngIf="p.status === 'PAID'; else unpaid">
    <small>Due on</small>
    {{ p.dueDate | date:'dd MMM yyyy' }}

    <small class="paid-on">Paid on</small>
    {{ p.paidOn | date:'dd MMM yyyy' }}
  </ng-container>

  <!-- UNPAID EMI -->
  <ng-template #unpaid>
    <small>Due on</small>
    {{ p.dueDate | date:'dd MMM yyyy' }}
  </ng-template>

</span>


      <span class="amount">₹ {{ p.amount }}</span>

      <span class="status-pill"
            [ngClass]="p.status.toLowerCase()">
        {{ p.status }}
      </span>

      <span class="action paid"
            *ngIf="p.status === 'PAID'">
        Paid
      </span>

      <span class="action pending"
            *ngIf="p.status !== 'PAID'">
        Pending
      </span>

    </div>
  </div>

  <p *ngIf="paymentsLoaded && !payments.length">
    No EMI history available
  </p>

  <p class="error" *ngIf="error">{{ error }}</p>

</div>
